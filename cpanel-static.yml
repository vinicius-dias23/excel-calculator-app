
---
# Configura√ß√£o alternativa para deploy est√°tico (caso o cPanel n√£o suporte Node.js)
deployment:
  tasks:
    # Navegar para o diret√≥rio da aplica√ß√£o
    - export DEPLOYPATH=/home/$USER/public_html/excel-calculator
    
    # Criar diret√≥rio de deploy se n√£o existir
    - mkdir -p $DEPLOYPATH
    
    # Limpar deploy anterior
    - rm -rf $DEPLOYPATH/*
    
    # Navegar para o diret√≥rio do projeto Next.js
    - cd $REPO/app
    
    # Instalar depend√™ncias usando yarn
    - /usr/bin/yarn install --frozen-lockfile
    
    # Configurar Next.js para export est√°tico
    - echo 'const nextConfig = { output: "export", distDir: "out", images: { unoptimized: true }, trailingSlash: true }; module.exports = nextConfig;' > next.config.export.js
    
    # Fazer build est√°tico da aplica√ß√£o Next.js
    - NEXT_CONFIG_FILE=next.config.export.js /usr/bin/yarn build
    
    # Copiar arquivos est√°ticos para o deploy
    - cp -r out/* $DEPLOYPATH/
    
    # Configurar permiss√µes
    - chmod -R 755 $DEPLOYPATH
    
    # Criar .htaccess para SPA routing
    - echo 'RewriteEngine On' > $DEPLOYPATH/.htaccess
    - echo 'RewriteCond %{REQUEST_FILENAME} !-f' >> $DEPLOYPATH/.htaccess
    - echo 'RewriteCond %{REQUEST_FILENAME} !-d' >> $DEPLOYPATH/.htaccess
    - echo 'RewriteRule ^(.*)$ /excel-calculator/index.html [QSA,L]' >> $DEPLOYPATH/.htaccess
    
    # Configurar headers para API (se necess√°rio)
    - echo 'Header always set Access-Control-Allow-Origin "*"' >> $DEPLOYPATH/.htaccess
    - echo 'Header always set Access-Control-Allow-Methods "GET,POST,OPTIONS,DELETE,PUT"' >> $DEPLOYPATH/.htaccess
    - echo 'Header always set Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range"' >> $DEPLOYPATH/.htaccess
    
    # Log de sucesso
    - echo "‚úÖ Deploy est√°tico conclu√≠do em $DEPLOYPATH"
    - ls -la $DEPLOYPATH
    - echo "üöÄ Aplica√ß√£o est√°tica Excel Calculator pronta!"
    - echo "üì± Acesse: https://seudominio.com/excel-calculator"
    - echo ""
    - echo "‚ö†Ô∏è  NOTA: Deploy est√°tico - funcionalidades que dependem de APIs do servidor podem n√£o funcionar"
